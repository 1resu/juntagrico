{% extends "mybase.html" %}

{% block content %}
    <h3>Alle Abos im Ãœberblick</h3>
    <style>
        .container {
            width: 1200px;
        }
    </style>
    <script src="../../static/js/ZeroClipboard.min.js" type="text/javascript"></script>
    <div id="filter-table">
        <table class="list" style="display: table;">
            <thead>
            <tr>
                <th>Hauptloco</th>
                <th>Weitere Locos</th>
                <th>Depot</th>
                <th>Bohnen</th>
                <th>Aktiv</th>
                <th>Emails <a data-clipboard-text="Copy Me!" id="copy-emails" href="#">alle kopieren</a></th>
            </tr>
            </thead>
            <tbody>
            {% for abo in abos %}
                <tr>
                    <td>{{ abo.abo.primary_loco.first_name }} {{ abo.abo.primary_loco.last_name }}</td>
                    <td>{{ abo.abo.bezieher }}</td>
                    <td>{{ abo.abo.depot.name }}</td>
                    <td>{{ abo.boehnlis }} <img alt="Status Erbse" src="/static/img/{{ abo.icon }}"/> {{ abo.text }}</td>
                    <td>{% if abo.abo.active %}<img alt="Volle Erbse" src="/static/img/erbse_voll.png"/> Aktiv{% else %}<img alt="Volle Erbse" src="/static/img/erbse_leer.png"/> Wartend{% endif %}</td>
                    <td>{% for bezieher in abo.abo.bezieher_locos %}{{ bezieher.user.email }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <br/><br/>

    <script type="text/javascript" src="/static/js/dable.js"></script>
    <script type="text/javascript" src="/static/js/jquery-1.9.0.min.js"></script>
    <script type="text/javascript">
        var dable = new Dable("filter-table");

        dable.UpdateDisplayedRows();        // Update the table
        dable.UpdateStyle();                // Reapply our styles


        var client = new ZeroClipboard(document.getElementById("copy-emails"), {
            moviePath: "/static/others/ZeroClipboard.swf"
        });

        client.on("load", function (client) {
            client.on("complete", function (client, args) {
                alert("Copied text to clipboard: " + args.text);
            });
        });
        setInterval(function () {
            var emails = [];
            $("#filter-table tr").each(function () {
                var txt = $("td:eq(5)", this).text();
                if (txt)
                    emails.push(txt);
            });
            client.setText(emails.join(", "));
        }, 200);
    </script>
{% endblock %}
